<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Summarizing ecological data • ecositer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Summarizing ecological data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ecositer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/accessing_vegetation_data.html">Accessing vegetation data</a></li>
    <li><a class="dropdown-item" href="../articles/ordinating_vegetation_data.html">Vegetation data ordination</a></li>
    <li><a class="dropdown-item" href="../articles/qc_vegetation_data.html">QC vegetation data</a></li>
    <li><a class="dropdown-item" href="../articles/summarizing_ecological_data.html">Summarizing ecological data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/natearoe/ecositer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Summarizing ecological data</h1>
                        <h4 data-toc-skip class="author">Nathan Roe</h4>
            
            <h4 data-toc-skip class="date">2025-01-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/natearoe/ecositer/blob/main/vignettes/summarizing_ecological_data.Rmd" class="external-link"><code>vignettes/summarizing_ecological_data.Rmd</code></a></small>
      <div class="d-none name"><code>summarizing_ecological_data.Rmd</code></div>
    </div>

    
    
<p><strong>About</strong></p>
<p><code>ecositer</code> has a category of functions used for
summarizing, all of which use a “summarize_” prefix. QC should be
performed prior to summarizing - <a href="https://natearoe.github.io/ecositer/articles/qc_vegetation_data.html">QCing
vegetation data</a>.</p>
<p><strong>Summarizing vegetation data by ecosite</strong>
<code><a href="../reference/QC_best_vegplot_for_site.html">QC_best_vegplot_for_site()</a></code> is used to summarize vegetation
data by ecosite, state, and phase. This function evaluates several
elements of data quality, and in some cases performs QC. An example of
performing QC is <code><a href="../reference/QC_aggregate_abundance.html">QC_aggregate_abundance()</a></code>, which is run by
default in this function. An example of evaluating elements of QC is
reporting if there are multiple state names associated with a stateid.
The messages produced by this function should be read and efforts should
be made to address the data quality conditions that are described in the
messages.</p>
<p>Load data</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D104_veg</span> <span class="op">&lt;-</span> <span class="fu">ecositer</span><span class="fu">::</span><span class="fu"><a href="../reference/create_veg_df.html">create_veg_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"web_report"</span>,</span>
<span>                                 ecositeid <span class="op">=</span> <span class="st">"F022AD104CA"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">##   object 'type_sum.accel' not found</span></span></code></pre>
<p>Summarize data</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D104_summary</span> <span class="op">&lt;-</span> <span class="fu">ecositer</span><span class="fu">::</span><span class="fu"><a href="../reference/summarize_veg_by_ecosite.html">summarize_veg_by_ecosite</a></span><span class="op">(</span>veg_df <span class="op">=</span> <span class="va">D104_veg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Note -&gt; akstratumcoverclasspct is the only abundance column used in this dataset</span></span></code></pre>
<pre><code><span><span class="co">## Warning -&gt; There are sites with multiple vegetation plots. Reviewing these sites is preferable to automated selection. To view which sites have multiple vegetation plots:</span></span>
<span><span class="co">##               'Your veg_df' |&gt; dplyr::group_by(siteiid) |&gt;</span></span>
<span><span class="co">##                                dplyr::summarise(unique_vegplots = dplyr::n_distinct(vegplotiid)) |&gt;</span></span>
<span><span class="co">##                                dplyr::filter(unique_vegplots &gt; 1)</span></span></code></pre>
<pre><code><span><span class="co">## Note -&gt; The following taxonomical changes have been made.</span></span></code></pre>
<pre><code><span><span class="co">## Castanopsis sempervirens changed to Chrysolepis sempervirens </span></span>
<span><span class="co">## Pinus latifolia changed to Pinus engelmannii</span></span></code></pre>
<pre><code><span><span class="co">## Warning -&gt; 17 records missing abundance. These records are removed from results.</span></span></code></pre>
<p>Note the warnings produced, such as multiple state names being
associated with the same stateid. The code to inspect such situations is
also supplied.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D104_veg</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">siteiid</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>unique_vegplots <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">vegplotiid</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">unique_vegplots</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 14 × 2</span></span></span>
<span><span class="co">##    siteiid unique_vegplots</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 1146902               2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 1169814               2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 1169819               2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 1169825               2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 1169826               2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 1169880               2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 912091                2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 912100                2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 912136                2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 912150                2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> 912154                2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> 949201                2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span> 949214                2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">14</span> 968053                2</span></span></code></pre>
<p>In this situation, the different state names are differences in
capitalized letters. I have seen many other cases in NASIS where
completely different state names are associated with the same stateid,
so it is worth checking this. Also, for the sake standardization, it is
worth having the names be exactly same (i.e., using the same
capitalization).</p>
<p>To examine the summarized data, type D104_summary and put a ‘$’ at
the end of it. The data structure output by
<code><a href="../reference/summarize_veg_by_ecosite.html">summarize_veg_by_ecosite()</a></code> is called a list. Lists are
extremely flexible data structure that work well for storing complex,
heterogeneous data.</p>
<p>The “$” allows you to access the elements at that location of the
list. Here is an example of accessing a dataframe stored within the list
structure. In this example, I am using <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head()</a></code> to concisely
show the output, but I recommend using <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code> to see the
full output and be able to sort by columns.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D104_summary</span><span class="op">$</span><span class="va">F022AD104CA</span><span class="op">$</span><span class="va">STM</span><span class="op">$</span><span class="va">state1</span><span class="op">$</span><span class="va">comm1</span><span class="op">$</span><span class="va">species_summary</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    plantsym          plantsciname       plantnatvernm constancy    mean median</span></span>
<span><span class="co">##      &lt;char&gt;                &lt;char&gt;              &lt;char&gt;     &lt;num&gt;   &lt;num&gt;  &lt;num&gt;</span></span>
<span><span class="co">## 1:     ABCO        Abies concolor           white fir      87.5 31.0875  28.15</span></span>
<span><span class="co">## 2:     PIJE        Pinus jeffreyi        Jeffrey pine      62.5  6.3125   2.10</span></span>
<span><span class="co">## 3:    ARPA6 Arctostaphylos patula greenleaf manzanita      50.0  1.0250   0.05</span></span>
<span><span class="co">## 4:   CADE27  Calocedrus decurrens       incense cedar      50.0  8.9125   0.05</span></span>
<span><span class="co">## 5:    GALIU                Galium            bedstraw      50.0  0.5375   0.05</span></span>
<span><span class="co">## 6:     PREM     Prunus emarginata       bitter cherry      50.0  0.6500   0.05</span></span>
<span><span class="co">##      min   max   sum  20th  80th sites_present sites_absent</span></span>
<span><span class="co">##    &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;         &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">## 1:     0  84.0 248.7  0.14 55.06             7            1</span></span>
<span><span class="co">## 2:     0  28.3  50.5  0.00  9.20             5            3</span></span>
<span><span class="co">## 3:     0   7.0   8.2  0.00  0.64             4            4</span></span>
<span><span class="co">## 4:     0  47.0  71.3  0.00 12.88             4            4</span></span>
<span><span class="co">## 5:     0   3.0   4.3  0.00  0.70             4            4</span></span>
<span><span class="co">## 6:     0   4.0   5.2  0.00  0.64             4            4</span></span></code></pre>
<p><strong>Summarizing pedon level soil data</strong> When analyzing
ecological communities, it is often helpful to work with summarized soil
properties that are not directly accessible from pedon data. Properties
of interest could include depth, texture, color, rock fragments, pH,
etc. Users may be interested in these properties within particular depth
ranges, across the entire soil profile, or within a particular master
horizon. An example could be weighted average clay percentage in the
first 100 cms or thickness of the surface O horizons (i.e., using O
master horizon).</p>
<p><code><a href="../reference/summarize_pedon_soil_properties.html">summarize_pedon_soil_properties()</a></code> generates a variety of
summarized properties that are useful for ecological analysis. I would
like to develop this function further, so if you have ideas, please
share!</p>
<p>For this example, I am using an example dataset from CA792, the
Sequoia and Kings Canyon National Park Soil Survey, from the <a href="https://github.com/natearoe/ecositer.data" class="external-link">ecositer.data</a>
package.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">CA792_pedon_data</span>, package <span class="op">=</span> <span class="st">"ecositer.data"</span><span class="op">)</span></span></code></pre></div>
<p>This data can be used in the <code>r_object</code> argument of
<code><a href="../reference/summarize_pedon_soil_properties.html">summarize_pedon_soil_properties()</a></code>. Alternatively, you could
use the <code>SS</code> or <code>static_location</code> arguments to
access NASIS data elsewhere.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CA792_pedon_summary</span> <span class="op">&lt;-</span> <span class="fu">ecositer</span><span class="fu">::</span><span class="fu"><a href="../reference/summarize_pedon_soil_properties.html">summarize_pedon_soil_properties</a></span><span class="op">(</span>SS <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                           r_object <span class="op">=</span> <span class="va">CA792_pedon_data</span>,</span>
<span>                                           byDepth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in max(h[[bottom]][no.contact.idx], na.rm = TRUE): no non-missing</span></span>
<span><span class="co">## arguments to max; returning -Inf</span></span></code></pre>
<pre><code><span><span class="co">## Warning in aqp::texcl_to_ssc(x$texcl): not all the user supplied texcl values</span></span>
<span><span class="co">## match the lookup table</span></span>
<span><span class="co">## Warning in aqp::texcl_to_ssc(x$texcl): not all the user supplied texcl values</span></span>
<span><span class="co">## match the lookup table</span></span>
<span><span class="co">## Warning in aqp::texcl_to_ssc(x$texcl): not all the user supplied texcl values</span></span>
<span><span class="co">## match the lookup table</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">aqp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/aqp/man/site.html" class="external-link">site</a></span><span class="op">(</span><span class="va">CA792_pedon_summary</span><span class="op">[[</span><span class="st">"full_profile"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"siteiid"</span>, <span class="st">"d_L_lowest_mineral"</span>, <span class="st">"o_surf_thk"</span>, <span class="st">"b_clay_wtd"</span>, <span class="st">"full_prof_ph_wtd"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   siteiid d_L_lowest_mineral o_surf_thk b_clay_wtd full_prof_ph_wtd</span></span>
<span><span class="co">## 1 1076986           51.40723          5  15.411765         6.210000</span></span>
<span><span class="co">## 2 1076988           51.41491          5  14.564815         6.092500</span></span>
<span><span class="co">## 3 1076989           71.55664          5   7.684211         5.340800</span></span>
<span><span class="co">## 4 1076990                 NA         10  12.533333         5.361905</span></span>
<span><span class="co">## 5 1076991           51.40723          8  34.000000         6.162000</span></span>
<span><span class="co">## 6 1076992           51.40723          5  27.305085         5.693333</span></span></code></pre>
<p><strong>Summarizing site climate data</strong> Climate data is a
critical factor driving the distribution of ecological communities and
individual species.
<code><a href="https://natearoe.github.io/ecositer/reference/site_prism_annual_normals.html">ecositerSpatial::site_prism_annual_normals()</a></code> can be used to
extract PRISM climate properties associated with specific sites.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>CA792_clim <span class="ot">&lt;-</span> ecositerSpatial<span class="sc">::</span><span class="fu">site_prism_annual_normals</span>(<span class="at">site_df =</span> CA792_veg_data),</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>                                           prism_dir <span class="ot">=</span> <span class="st">"C:/Users/Nathan.Roe/Documents/PRISM_R/annual"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>                                           id <span class="ot">=</span> <span class="st">"siteiid"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>                                           x <span class="ot">=</span> <span class="st">"utmeasting"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>                                           y <span class="ot">=</span> <span class="st">"utmnorthing"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>                                           EPSG <span class="ot">=</span> <span class="st">"EPSG:32611"</span><span class="er">)</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="fu">head</span>(CA792_clim)</span></code></pre></div>
<pre><code><span><span class="co">##   siteiid      ppt tmean   tmin    tmax tdmean vpdmin vpdmax</span></span>
<span><span class="co">## 1 1093605  920.948 10.57 4.8099 16.3299  -0.35   3.81  14.71</span></span>
<span><span class="co">## 2 1093606  932.602 10.01 5.3700 14.6500  -0.06   3.99  12.56</span></span>
<span><span class="co">## 3 1093607  948.341  9.82 4.7699 14.8700  -0.65   3.86  13.17</span></span>
<span><span class="co">## 4 1093608 1080.049  9.34 4.5199 14.1600  -0.84   3.78  12.39</span></span>
<span><span class="co">## 5 1093609 1309.006  7.54 1.9600 13.1300  -3.29   3.29  12.26</span></span>
<span><span class="co">## 6 1093611 1309.006  7.54 1.9600 13.1300  -3.29   3.29  12.26</span></span></code></pre>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nathan Roe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
