<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>QC vegetation data • ecositer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="QC vegetation data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ecositer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/accessing_vegetation_data.html">Accessing vegetation data</a></li>
    <li><a class="dropdown-item" href="../articles/qc_vegetation_data.html">QC vegetation data</a></li>
    <li><a class="dropdown-item" href="../articles/summarizing_vegetation_data.html">Summarizing vegetation data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/natearoe/ecositer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>QC vegetation data</h1>
                        <h4 data-toc-skip class="author">Nathan Roe</h4>
            
            <h4 data-toc-skip class="date">2024-12-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/natearoe/ecositer/blob/main/vignettes/qc_vegetation_data.Rmd" class="external-link"><code>vignettes/qc_vegetation_data.Rmd</code></a></small>
      <div class="d-none name"><code>qc_vegetation_data.Rmd</code></div>
    </div>

    
    
<p><strong>About</strong></p>
<p><code>ecositer</code> has a category of functions used for QC, all of
which use a “QC_” prefix. Vegetation data stored in NASIS requires QC.
There are numerous issues that exist caused by different data vintages,
data origins, varying data quality, duplication caused by KSSL lab
pedons, outdated plant taxonomies, and more. This vignette discusses a
best practice methodology for QC NASIS vegetation data.</p>
<p>You should start your QC process by removing data at the coarsest
level that meets your objectives. This will ensure that you do not spend
time fixing obscure edge cases that are ultimately removed.</p>
<p>To begin with, we are going to build our dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D104_veg</span> <span class="op">&lt;-</span> <span class="fu">ecositer</span><span class="fu">::</span><span class="fu"><a href="../reference/create_veg_df.html">create_veg_df</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"web_report"</span>,</span>
<span>                                 ecositeid <span class="op">=</span> <span class="st">"F022AD104CA"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">##   object 'type_sum.accel' not found</span></span></code></pre>
<p><strong>Choose the best vegetation plot for site</strong></p>
<p>Sites may have multiple vegetation plots with differing data
qualities. If there are multiple vegetation plots associated with a
site, <code><a href="../reference/QC_best_vegplot_for_site.html">QC_best_vegplot_for_site()</a></code> chooses the vegetation
plot with the most records.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D104_veg_best</span> <span class="op">&lt;-</span> <span class="fu">ecositer</span><span class="fu">::</span><span class="fu"><a href="../reference/QC_best_vegplot_for_site.html">QC_best_vegplot_for_site</a></span><span class="op">(</span>veg_df <span class="op">=</span> <span class="va">D104_veg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There are sites with multiple vegetation plots. Reviewing these sites is preferable to automated selection. To view which sites have multiple vegetation plots:</span></span>
<span><span class="co">##               'Your veg_df' |&gt; dplyr::group_by(siteiid) |&gt;</span></span>
<span><span class="co">##                                dplyr::summarise(unique_vegplots = dplyr::n_distinct(vegplotiid)) |&gt;</span></span>
<span><span class="co">##                                dplyr::filter(unique_vegplots &gt; 1)</span></span></code></pre>
<p>To look at all the sites with multiple vegetation plots:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D104_multi_veg</span> <span class="op">&lt;-</span> <span class="va">D104_veg</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">siteiid</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>unique_vegplots <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">vegplotiid</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>has_multiple_vegplots <span class="op">=</span> <span class="va">unique_vegplots</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">has_multiple_vegplots</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">D104_multi_veg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">##   siteiid unique_vegplots has_multiple_vegplots</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 1146902               2 TRUE                 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 1169814               2 TRUE                 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 1169819               2 TRUE                 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 1169825               2 TRUE                 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 1169826               2 TRUE                 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 1169880               2 TRUE</span></span></code></pre>
<p><strong>Creating an aggregated abundance column</strong></p>
<p>Now, we are going to create an aggregated abundance column called,
“pct_cover”. There are four columns where abundance data could be
stored: akstratumcoverclasspct, speciescancovpct, speciescomppct,
understorygrcovpct. A couple of functions will be used to inspect what
abundance columns are used in your dataset and whether any records in
your dataset have multiple abundance columns used.</p>
<p><code><a href="../reference/QC_aggregate_abundance.html">QC_aggregate_abundance()</a></code> aggregates the four abundance
columns into the new “pct_cover” column. If any records have multiple
abundance columns used, this function will average them and issue a
warning or error depending on the <code>fail_on_dup</code> argument. For
details on this function - <code>?QC_aggregate_abundance()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D104_veg_agg</span> <span class="op">&lt;-</span> <span class="fu">ecositer</span><span class="fu">::</span><span class="fu"><a href="../reference/QC_aggregate_abundance.html">QC_aggregate_abundance</a></span><span class="op">(</span>veg_df <span class="op">=</span> <span class="va">D104_veg_best</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in ecositer::QC_aggregate_abundance(veg_df = D104_veg_best): Multiple</span></span>
<span><span class="co">## abundance columns are used in this dataset: akstratumcoverclasspct,</span></span>
<span><span class="co">## speciescancovpct</span></span></code></pre>
<pre><code><span><span class="co">## Warning in ecositer::QC_aggregate_abundance(veg_df = D104_veg_best): Some</span></span>
<span><span class="co">## records have multiple abundance values populated. Use</span></span>
<span><span class="co">## `ecositer::QC_find_multiple_abundance()` to investigate the affected plots and</span></span>
<span><span class="co">## records.</span></span></code></pre>
<p>Note the two warnings above. As mentioned in the warning,
<code><a href="../reference/QC_find_multiple_abundance.html">QC_find_multiple_abundance()</a></code> will allow you to inspect
which records have abundance data in multiple columns. These should be
inspected to determine why multiple abundance columns are used. The
other warning shows that two total abundance columns were used in this
dataset.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abund_dups</span> <span class="op">&lt;-</span> <span class="fu">ecositer</span><span class="fu">::</span><span class="fu"><a href="../reference/QC_find_multiple_abundance.html">QC_find_multiple_abundance</a></span><span class="op">(</span>veg_df <span class="op">=</span> <span class="va">D104_veg</span><span class="op">)</span></span>
<span><span class="va">abund_dups</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] siteiid                usiteid                siteobsiid            </span></span>
<span><span class="co">##  [4] vegplotid              vegplotiid             primarydatacollector  </span></span>
<span><span class="co">##  [7] vegdataorigin          ecositeid              ecositenm             </span></span>
<span><span class="co">## [10] ecostateid             ecostatename           commphaseid           </span></span>
<span><span class="co">## [13] commphasename          plantsym               plantsciname          </span></span>
<span><span class="co">## [16] plantnatvernm          akstratumcoverclasspct speciescancovpct      </span></span>
<span><span class="co">## [19] speciescomppct         understorygrcovpct     horizdatnm            </span></span>
<span><span class="co">## [22] utmzone                utmeasting             utmnorthing           </span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre>
<p><strong>Assign minimum criteria for vegetation data
quality</strong></p>
<p>Now that we have an aggregated abundance column, we can begin with
our coarse filter of the data. First we will use
<code><a href="../reference/QC_veg_completeness.html">QC_veg_completeness()</a></code> to describe the completeness and
quality of vegplot observations.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ecositer</span><span class="fu">::</span><span class="fu"><a href="../reference/QC_veg_completeness.html">QC_veg_completeness</a></span><span class="op">(</span>veg_df <span class="op">=</span> <span class="va">D104_veg_agg</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   siteiid siteobsiid vegplotiid primarydatacollector           vegdataorigin</span></span>
<span><span class="co">## 1 1093611    1069569     277250                      site existing veg table</span></span>
<span><span class="co">## 2  968053     950512     958427                   DE        spreadsheet form</span></span>
<span><span class="co">## 3  888801     864161     954378                                             </span></span>
<span><span class="co">## 4  949201     922060     958629                   DE        spreadsheet form</span></span>
<span><span class="co">## 5  949204     922063     276227                      site existing veg table</span></span>
<span><span class="co">## 6  949214     922073     958642                 DESK        spreadsheet form</span></span>
<span><span class="co">##   total_records unique_species percent_to_species percent_with_abund</span></span>
<span><span class="co">## 1             3              3          100.00000                  0</span></span>
<span><span class="co">## 2            17             16           52.94118                100</span></span>
<span><span class="co">## 3             1              1            0.00000                  0</span></span>
<span><span class="co">## 4            16             12           68.75000                100</span></span>
<span><span class="co">## 5             8              8          100.00000                100</span></span>
<span><span class="co">## 6            18              9           72.22222                100</span></span></code></pre>
<p>Next, we can remove plots that do not meet a minimum threshold for
data quality and completeness. The threshold should be specific to your
data set and study area.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D104_veg_agg</span> <span class="op">&lt;-</span> <span class="fu">ecositer</span><span class="fu">::</span><span class="fu"><a href="../reference/QC_completeness_criteria.html">QC_completeness_criteria</a></span><span class="op">(</span>veg_df <span class="op">=</span> <span class="va">D104_veg_agg</span>,</span>
<span>                                   min_unique_species <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                   min_perc_to_species <span class="op">=</span> <span class="fl">60</span>,</span>
<span>                                   min_perc_with_abund <span class="op">=</span> <span class="fl">80</span><span class="op">)</span></span></code></pre></div>
<p><strong>Update taxonomy using USDA PLANTS</strong></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D104_veg_agg</span> <span class="op">&lt;-</span> <span class="fu">ecositer</span><span class="fu">::</span><span class="fu"><a href="../reference/QC_update_taxonomy.html">QC_update_taxonomy</a></span><span class="op">(</span>veg_df <span class="op">=</span> <span class="va">D104_veg_agg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Note: The following taxonomical changes have been made.</span></span></code></pre>
<pre><code><span><span class="co">## Pinus latifolia changed to Pinus engelmannii</span></span></code></pre>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nathan Roe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
